local   all             postgres                                peer
local   all             all                                     peer
host    all             all             127.0.0.1/32            md5
host    all             all             ::1/128                 md5
local   replication     all                                     peer
host    replication     all             127.0.0.1/32            md5
host    replication     all             ::1/128                 md5

{% for host in groups['db'] %}
host all patroni {{ hostvars[host]['ansible_eth0']['ipv4']['address'] }}/32 md5
host replication replicator {{ hostvars[host]['ansible_eth0']['ipv4']['address'] }}/32 md5
{% endfor %}
{% for host in extra_pg_hba_hosts %}
host {{ host.database }} {{ host.username }} {{ host.ip }}/32 md5
{% endfor %}
